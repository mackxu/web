<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<title>新闻向上滚动</title>
	<script type="text/javascript" src="../../jquery-1.9.1.js"></script>
	<script type="text/javascript" src="news-feed.js"></script>
	<link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
<h3>新闻时速</h3>
<div id="news-feed">
	<a href="#">最新报道</a>
</div>
<script type="text/javascript">
	$(document).ready(function() {
		// 如果不存在div#news-feed则回调函数不执行
		// 等同if+私有空间
		$('#news-feed').each(function() {
			$container = $(this);
			this.innerHTML = '';							// 清空新闻源

			var html = '';
			for(var i=0, len=news.length; i<len; i++) {
				var headline = news[i];
				html += '<div class="headline"><h4><a href="'
					+ headline.link +'">'+ headline.title +'</a></h4>';
				html += '<div class="publication-date">'+ headline.datetime +'</div>';
				html += '<div class="summary">'+ headline.summary +'</div></div>';
			}
			this.innerHTML = html;

			// 为底部添加渐变效果
			var fadeHeight = $container.height() / 4;
			for(var yPos=0; yPos<fadeHeight; yPos+=2) {
				$('<div></div>').css({
					opacity: yPos / fadeHeight,
					top: $container.height() - fadeHeight + yPos
				}).addClass('fade-slice').appendTo($container);
			}

			var currentHeadline = 0,						// 当前要显示的新闻
				oldHeadline = 0,							// 将被移出的新闻
				$headlines = $('div.headline'),				// 数组，所有新闻
				headlineCount = $headlines.length,			// 翻转新闻的个数
				hiddenPosition = $container.height() + 10,	// 新闻隐藏的绝对位置
				pauseTime = 5000;							// 新闻停留时间
				pause = null;
			// 新闻翻转函数
			// 移出旧新闻，显示当前新闻
			var headlineRotate = function() {
				// 将要显示的新闻
				currentHeadline = (oldHeadline + 1) % headlineCount;
				
				$headlines
					// 将旧标题移出视图
					.eq(oldHeadline).animate({top: -hiddenPosition}, 'slow', function() {
						$(this).css('top', hiddenPosition);
					}).end()
					// 将新新闻滑入视图
					.eq(currentHeadline).animate({top: 0}, 'slow', function() {
						// 停留特定时间后滑出
						clearTimeout(pause);							// 关闭所有计时器
						pause = setTimeout(headlineRotate, pauseTime);	// 开启新的计时器
					});
				
				oldHeadline = currentHeadline;							// 设置等待移出的新闻
			};
			$container.hover(function() {								// 当鼠标移入时
				clearTimeout(pause);									// 取消当前动画
			}, function() {												// 当鼠标移出
				clearTimeout(pause);
				pause = setTimeout(headlineRotate, 250);				// 重新启动动画
			});

			// 初始化状态
			$headlines.eq(currentHeadline).css('top', 0);
			// 开始动画
			clearTimeout(pause);
			pause = setTimeout(headlineRotate, pauseTime);				// 5s后开始动画
		});
	});
</script>
</body>
</html>